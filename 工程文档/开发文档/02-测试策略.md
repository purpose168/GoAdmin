# GoAdmin 测试策略

## 文档信息

- **项目名称**: GoAdmin
- **文档版本**: v1.0
- **创建日期**: 2026-01-05
- **最后更新**: 2026-01-05
- **文档类型**: 测试策略

---

## 1. 测试概述

### 1.1 测试目标

GoAdmin 测试策略旨在确保代码质量、功能正确性和系统稳定性。测试覆盖以下方面:

- **功能正确性**: 确保所有功能按预期工作
- **代码质量**: 发现并修复代码缺陷
- **性能优化**: 识别性能瓶颈并优化
- **安全性**: 发现安全漏洞并修复
- **兼容性**: 确保在不同环境下正常工作

### 1.2 测试原则

1. **测试先行**: 在编写代码前编写测试
2. **全面覆盖**: 确保测试覆盖所有关键功能
3. **独立性**: 每个测试应该独立运行
4. **可重复**: 测试结果应该可重复
5. **快速执行**: 单元测试应该快速执行
6. **清晰明确**: 测试名称和断言应该清晰明确

### 1.3 测试分类

```
测试金字塔
       /\
      /  \
     / E2E \        端到端测试 (少量)
    /------\
   / 集成测试 \      集成测试 (适量)
  /----------\
 /   单元测试   \    单元测试 (大量)
/--------------\
```

| 测试类型 | 数量 | 执行速度 | 成本 | 覆盖范围 |
|---------|------|---------|------|---------|
| 单元测试 | 大量 | 快 | 低 | 函数/方法 |
| 集成测试 | 适量 | 中 | 中 | 模块/组件 |
| 端到端测试 | 少量 | 慢 | 高 | 完整流程 |

---

## 2. 单元测试

### 2.1 测试框架

GoAdmin 使用以下测试框架:

- **testing**: Go 标准测试框架
- **testify**: 断言库和 Mock 框架
- **goconvey**: BDD 风格测试框架
- **gomonkey**: Monkey patching 框架

### 2.2 测试文件组织

**测试文件命名**:
- 测试文件以 `_test.go` 结尾
- 测试文件与被测试文件在同一目录

```
modules/
  auth/
    auth.go
    auth_test.go
  db/
    db.go
    db_test.go
```

### 2.3 测试编写规范

#### 2.3.1 基本测试结构

```go
package auth

import (
    "testing"
    "github.com/stretchr/testify/assert"
    "github.com/stretchr/testify/require"
)

func TestLogin(t *testing.T) {
    // 准备测试数据
    username := "admin"
    password := "password"

    // 执行测试
    user, err := Login(username, password)

    // 断言结果
    require.NoError(t, err)
    assert.NotNil(t, user)
    assert.Equal(t, username, user.Username)
}
```

#### 2.3.2 表驱动测试

```go
func TestValidateEmail(t *testing.T) {
    tests := []struct {
        name    string
        email   string
        want    bool
        wantErr bool
    }{
        {
            name:    "valid email",
            email:   "test@example.com",
            want:    true,
            wantErr: false,
        },
        {
            name:    "invalid email",
            email:   "invalid",
            want:    false,
            wantErr: true,
        },
        {
            name:    "empty email",
            email:   "",
            want:    false,
            wantErr: true,
        },
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            got, err := ValidateEmail(tt.email)
            if (err != nil) != tt.wantErr {
                t.Errorf("ValidateEmail() error = %v, wantErr %v", err, tt.wantErr)
                return
            }
            if got != tt.want {
                t.Errorf("ValidateEmail() = %v, want %v", got, tt.want)
            }
        })
    }
}
```

#### 2.3.3 使用 testify

```go
import (
    "testing"
    "github.com/stretchr/testify/assert"
    "github.com/stretchr/testify/mock"
    "github.com/stretchr/testify/require"
    "github.com/stretchr/testify/suite"
)

// Mock 对象
type MockDB struct {
    mock.Mock
}

func (m *MockDB) GetUser(id int) (*User, error) {
    args := m.Called(id)
    if args.Get(0) == nil {
        return nil, args.Error(1)
    }
    return args.Get(0).(*User), args.Error(1)
}

// 测试套件
type UserServiceTestSuite struct {
    suite.Suite
    service *UserService
    db      *MockDB
}

func (suite *UserServiceTestSuite) SetupTest() {
    suite.db = new(MockDB)
    suite.service = NewUserService(suite.db)
}

func (suite *UserServiceTestSuite) TestGetUser() {
    // 设置 Mock 期望
    suite.db.On("GetUser", 1).Return(&User{ID: 1, Username: "admin"}, nil)

    // 执行测试
    user, err := suite.service.GetUser(1)

    // 断言
    require.NoError(suite.T(), err)
    assert.Equal(suite.T(), "admin", user.Username)

    // 验证 Mock 调用
    suite.db.AssertExpectations(suite.T())
}

func TestUserServiceTestSuite(t *testing.T) {
    suite.Run(t, new(UserServiceTestSuite))
}
```

#### 2.3.4 使用 GoConvey

```go
import (
    . "github.com/smartystreets/goconvey/convey"
    "testing"
)

func TestAdd(t *testing.T) {
    Convey("Add two numbers", t, func() {
        Convey("should return sum", func() {
            So(Add(1, 2), ShouldEqual, 3)
            So(Add(2, 3), ShouldEqual, 5)
        })

        Convey("should handle negative numbers", func() {
            So(Add(-1, 1), ShouldEqual, 0)
            So(Add(-1, -1), ShouldEqual, -2)
        })
    })
}
```

### 2.4 测试覆盖率

#### 2.4.1 运行测试并查看覆盖率

```bash
# 运行测试并显示覆盖率
go test -cover ./...

# 生成覆盖率报告
go test -coverprofile=coverage.out ./...

# 查看覆盖率报告
go tool cover -func=coverage.out

# 生成 HTML 覆盖率报告
go tool cover -html=coverage.out
```

#### 2.4.2 覆盖率要求

| 代码类型 | 覆盖率要求 |
|---------|-----------|
| 核心业务逻辑 | ≥ 80% |
| 一般业务逻辑 | ≥ 70% |
| 工具函数 | ≥ 60% |
| 配置代码 | ≥ 50% |

### 2.5 Mock 和 Stub

#### 2.5.1 使用 testify/mock

```go
import "github.com/stretchr/testify/mock"

type MockUserRepository struct {
    mock.Mock
}

func (m *MockUserRepository) FindByID(id int) (*User, error) {
    args := m.Called(id)
    if args.Get(0) == nil {
        return nil, args.Error(1)
    }
    return args.Get(0).(*User), args.Error(1)
}

func TestUserService_GetUser(t *testing.T) {
    mockRepo := new(MockUserRepository)
    service := NewUserService(mockRepo)

    mockRepo.On("FindByID", 1).Return(&User{ID: 1}, nil)

    user, err := service.GetUser(1)

    assert.NoError(t, err)
    assert.NotNil(t, user)
    mockRepo.AssertExpectations(t)
}
```

#### 2.5.2 使用 gomonkey

```go
import "github.com/agiledragon/gomonkey/v2"

func TestGetExternalData(t *testing.T) {
    // Mock 外部函数
    patches := gomonkey.ApplyFunc(http.Get, func(url string) (*http.Response, error) {
        return &http.Response{
            StatusCode: 200,
            Body:       ioutil.NopCloser(strings.NewReader(`{"data": "test"}`)),
        }, nil
    })
    defer patches.Reset()

    data, err := GetExternalData("http://example.com")

    assert.NoError(t, err)
    assert.Equal(t, "test", data)
}
```

---

## 3. 集成测试

### 3.1 测试环境

#### 3.1.1 测试数据库

GoAdmin 支持多种数据库的集成测试:

- MySQL
- PostgreSQL
- SQLite
- SQL Server

**测试数据库配置**:

```bash
# MySQL
export TEST_DB_HOST=db_mysql
export TEST_DB_PORT=3306
export TEST_DB_USER=root
export TEST_DB_PASSWORD=root
export TEST_DB_NAME=goadmin-test

# PostgreSQL
export TEST_DB_HOST=db_pgsql
export TEST_DB_PORT=5432
export TEST_DB_USER=postgres
export TEST_DB_PASSWORD=root
export TEST_DB_NAME=goadmin-test
```

#### 3.1.2 Docker Compose 测试环境

**docker-compose.test.yml**:

```yaml
version: "3.3"

services:
  mysql:
    image: mysql:5.6
    container_name: test_mysql
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=goadmin-test

  postgres:
    image: postgres:latest
    container_name: test_postgres
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASSWORD=root
      - POSTGRES_DB=goadmin-test

  mssql:
    image: mcr.microsoft.com/mssql/server:2019-latest
    container_name: test_mssql
    ports:
      - "1433:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=Aa123456
```

**启动测试环境**:

```bash
docker-compose -f docker-compose.test.yml up -d
```

### 3.2 集成测试编写

#### 3.2.1 数据库集成测试

```go
package db

import (
    "testing"
    "github.com/stretchr/testify/assert"
    "github.com/stretchr/testify/require"
)

func TestDBIntegration(t *testing.T) {
    if testing.Short() {
        t.Skip("skipping integration test")
    }

    // 连接测试数据库
    conn, err := Connect("mysql", "root:root@tcp(localhost:3306)/goadmin-test")
    require.NoError(t, err)
    defer conn.Close()

    // 创建测试表
    _, err = conn.Exec(`
        CREATE TABLE IF NOT EXISTS users (
            id INT AUTO_INCREMENT PRIMARY KEY,
            username VARCHAR(100) NOT NULL,
            email VARCHAR(100) NOT NULL
        )
    `)
    require.NoError(t, err)

    // 插入测试数据
    _, err = conn.Exec("INSERT INTO users (username, email) VALUES (?, ?)", "admin", "admin@example.com")
    require.NoError(t, err)

    // 查询测试数据
    rows, err := conn.Query("SELECT id, username, email FROM users WHERE username = ?", "admin")
    require.NoError(t, err)
    defer rows.Close()

    var user User
    if rows.Next() {
        err = rows.Scan(&user.ID, &user.Username, &user.Email)
        require.NoError(t, err)
    }

    assert.Equal(t, "admin", user.Username)
    assert.Equal(t, "admin@example.com", user.Email)
}
```

#### 3.2.2 API 集成测试

```go
package api

import (
    "net/http"
    "net/http/httptest"
    "testing"
    "github.com/stretchr/testify/assert"
)

func TestUserAPI(t *testing.T) {
    // 创建测试路由
    router := setupRouter()

    // 测试获取用户
    req, _ := http.NewRequest("GET", "/api/users/1", nil)
    w := httptest.NewRecorder()
    router.ServeHTTP(w, req)

    assert.Equal(t, http.StatusOK, w.Code)
    assert.Contains(t, w.Body.String(), "admin")

    // 测试创建用户
    req, _ = http.NewRequest("POST", "/api/users", strings.NewReader(`{"username":"test","email":"test@example.com"}`))
    w = httptest.NewRecorder()
    router.ServeHTTP(w, req)

    assert.Equal(t, http.StatusCreated, w.Code)
}
```

### 3.3 集成测试执行

```bash
# 运行所有集成测试
go test -v ./...

# 运行特定包的集成测试
go test -v ./modules/db/...

# 跳过短测试
go test -v -short=false ./...

# 运行带超时的测试
go test -v -timeout 30s ./...
```

---

## 4. 黑盒测试

### 4.1 测试框架

GoAdmin 使用以下黑盒测试框架:

- **httpexpect**: HTTP 测试框架
- **agouti**: Web 浏览器自动化测试框架

### 4.2 框架测试

GoAdmin 对所有支持的 Web 框架进行黑盒测试:

- Gin
- Echo
- Chi
- Iris
- Beego
- Fiber
- Buffalo
- Gear
- GoFrame
- NetHTTP

### 4.3 黑盒测试编写

#### 4.3.1 使用 httpexpect

```go
package tests

import (
    "net/http"
    "testing"
    "github.com/gavv/httpexpect"
)

func TestUserAPI(t *testing.T) {
    // 创建测试服务器
    server := setupTestServer()
    defer server.Close()

    // 创建 httpexpect 实例
    e := httpexpect.New(t, server.URL)

    // 测试获取用户列表
    e.GET("/api/users").
        Expect().
        Status(http.StatusOK).
        JSON().Array().Length().Gt(0)

    // 测试获取单个用户
    e.GET("/api/users/1").
        Expect().
        Status(http.StatusOK).
        JSON().Object().
        Value("id").Equal(1).
        Value("username").Equal("admin")

    // 测试创建用户
    e.POST("/api/users").
        WithJSON(map[string]string{
            "username": "test",
            "email":    "test@example.com",
        }).
        Expect().
        Status(http.StatusCreated).
        JSON().Object().
        Value("username").Equal("test")
}
```

#### 4.3.2 使用 agouti

```go
package tests

import (
    "testing"
    "github.com/sclevine/agouti"
)

func TestLogin(t *testing.T) {
    // 启动浏览器
    agoutiDriver := agouti.ChromeDriver()
    defer agoutiDriver.Stop()

    page, err := agoutiDriver.NewPage(agouti.Browser("chrome"))
    require.NoError(t, err)

    // 访问登录页面
    err = page.Navigate("http://localhost:8080/login")
    require.NoError(t, err)

    // 填写登录表单
    err = page.Find("#username").Fill("admin")
    require.NoError(t, err)

    err = page.Find("#password").Fill("password")
    require.NoError(t, err)

    // 提交表单
    err = page.Find("#login-button").Click()
    require.NoError(t, err)

    // 验证登录成功
    err = page.Find(".welcome-message").ShouldContain("Welcome, admin")
    require.NoError(t, err)
}
```

### 4.4 黑盒测试执行

```bash
# 运行所有黑盒测试
make black-box-test

# 运行 MySQL 黑盒测试
make mysql-test

# 运行 PostgreSQL 黑盒测试
make pg-test

# 运行 SQLite 黑盒测试
make sqlite-test

# 运行 SQL Server 黑盒测试
make ms-test
```

---

## 5. Web 测试

### 5.1 测试类型

Web 测试包括:

- **功能测试**: 测试 Web 界面功能
- **UI 测试**: 测试用户界面
- **兼容性测试**: 测试浏览器兼容性

### 5.2 Web 测试编写

```go
package web

import (
    "testing"
    "github.com/sclevine/agouti"
)

func TestWebInterface(t *testing.T) {
    // 启动浏览器
    driver := agouti.ChromeDriver()
    defer driver.Stop()

    page, err := driver.NewPage(agouti.Browser("chrome"))
    require.NoError(t, err)

    // 访问首页
    err = page.Navigate("http://localhost:8080")
    require.NoError(t, err)

    // 测试登录
    err = page.Find("#username").Fill("admin")
    require.NoError(t, err)

    err = page.Find("#password").Fill("password")
    require.NoError(t, err)

    err = page.Find("#login-button").Click()
    require.NoError(t, err)

    // 测试导航
    err = page.Find(".nav-menu").Click()
    require.NoError(t, err)

    err = page.Find(".menu-item[data-path='/admin/users']").Click()
    require.NoError(t, err)

    // 验证页面内容
    err = page.Find(".page-title").ShouldContain("用户管理")
    require.NoError(t, err)

    // 测试创建用户
    err = page.Find(".create-button").Click()
    require.NoError(t, err)

    err = page.Find("#username").Fill("testuser")
    require.NoError(t, err)

    err = page.Find("#email").Fill("test@example.com")
    require.NoError(t, err)

    err = page.Find(".save-button").Click()
    require.NoError(t, err)

    // 验证创建成功
    err = page.Find(".alert-success").ShouldContain("创建成功")
    require.NoError(t, err)
}
```

### 5.3 Web 测试执行

```bash
# 运行 Web 测试
make web-test

# 运行 Web 测试（调试模式）
make web-test-debug
```

---

## 6. 性能测试

### 6.1 基准测试

#### 6.1.1 编写基准测试

```go
package utils

import "testing"

func BenchmarkAdd(b *testing.B) {
    for i := 0; i < b.N; i++ {
        Add(1, 2)
    }
}

func BenchmarkStringConcat(b *testing.B) {
    for i := 0; i < b.N; i++ {
        s := ""
        for j := 0; j < 100; j++ {
            s += "a"
        }
    }
}

func BenchmarkStringBuilder(b *testing.B) {
    for i := 0; i < b.N; i++ {
        var builder strings.Builder
        for j := 0; j < 100; j++ {
            builder.WriteString("a")
        }
        builder.String()
    }
}
```

#### 6.1.2 运行基准测试

```bash
# 运行基准测试
go test -bench=. -benchmem

# 运行特定基准测试
go test -bench=BenchmarkAdd -benchmem

# 运行基准测试并生成 CPU profile
go test -bench=. -cpuprofile=cpu.prof

# 运行基准测试并生成内存 profile
go test -bench=. -memprofile=mem.prof
```

### 6.2 压力测试

#### 6.2.1 使用 vegeta

```bash
# 安装 vegeta
go install github.com/tsenart/vegeta@latest

# 创建测试目标
echo "GET http://localhost:8080/api/users" | vegeta attack -rate=100 -duration=30s | vegeta report

# 生成报告
echo "GET http://localhost:8080/api/users" | vegeta attack -rate=100 -duration=30s | vegeta report -type=json > report.json
```

#### 6.2.2 使用 wrk

```bash
# 安装 wrk
sudo apt-get install wrk

# 运行压测
wrk -t4 -c100 -d30s http://localhost:8080/api/users
```

---

## 7. 测试数据管理

### 7.1 测试数据准备

#### 7.1.1 数据库测试数据

**tests/data/admin.sql**:

```sql
-- 创建测试表
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 插入测试数据
INSERT INTO users (username, email, password) VALUES
('admin', 'admin@example.com', '$2a$10$N9qo8uLOickgx2ZMRZoMy.MrqJn6.5qJn.5qJn.5qJn.5qJn.5qJn.'),
('user1', 'user1@example.com', '$2a$10$N9qo8uLOickgx2ZMRZoMy.MrqJn6.5qJn.5qJn.5qJn.5qJn.5qJn.'),
('user2', 'user2@example.com', '$2a$10$N9qo8uLOickgx2ZMRZoMy.MrqJn6.5qJn.5qJn.5qJn.5qJn.5qJn.');
```

#### 7.1.2 导入测试数据

```bash
# 导入 MySQL 测试数据
make import-mysql

# 导入 PostgreSQL 测试数据
make import-postgresql

# 导入 SQLite 测试数据
make import-sqlite

# 导入 SQL Server 测试数据
make import-mssql
```

### 7.2 测试数据清理

#### 7.2.1 使用测试容器

```go
func TestWithCleanup(t *testing.T) {
    // 创建测试数据库容器
    container, err := testcontainers.GenericContainer(ctx, testcontainers.GenericContainerRequest{
        ContainerRequest: testcontainers.ContainerRequest{
            Image:        "mysql:5.6",
            ExposedPorts: []string{"3306/tcp"},
            Env: map[string]string{
                "MYSQL_ROOT_PASSWORD": "root",
                "MYSQL_DATABASE":      "test",
            },
        },
        Started: true,
    })
    require.NoError(t, err)
    defer container.Terminate(ctx)

    // 获取容器端口
    port, err := container.MappedPort(ctx, "3306")
    require.NoError(t, err)

    // 连接测试数据库
    conn, err := Connect("mysql", fmt.Sprintf("root:root@tcp(localhost:%s)/test", port.Port()))
    require.NoError(t, err)
    defer conn.Close()

    // 运行测试
    // ...
}
```

#### 7.2.2 使用事务回滚

```go
func TestWithTransaction(t *testing.T) {
    // 开始事务
    tx, err := db.Begin()
    require.NoError(t, err)
    defer tx.Rollback()

    // 在事务中执行测试
    _, err = tx.Exec("INSERT INTO users (username, email) VALUES (?, ?)", "test", "test@example.com")
    require.NoError(t, err)

    // 验证结果
    var count int
    err = tx.QueryRow("SELECT COUNT(*) FROM users WHERE username = ?", "test").Scan(&count)
    require.NoError(t, err)
    assert.Equal(t, 1, count)

    // 事务回滚，测试数据不会持久化
}
```

---

## 8. 持续集成

### 8.1 CI/CD 配置

#### 8.1.1 GitHub Actions

**.github/workflows/test.yml**:

```yaml
name: Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest

    services:
      mysql:
        image: mysql:5.6
        env:
          MYSQL_ROOT_PASSWORD: root
          MYSQL_DATABASE: goadmin-test
        ports:
          - 3306:3306
        options: --health-cmd="mysqladmin ping" --health-interval=10s --health-timeout=5s --health-retries=3

      postgres:
        image: postgres:latest
        env:
          POSTGRES_PASSWORD: root
          POSTGRES_DB: goadmin-test
        ports:
          - 5432:5432
        options: --health-cmd="pg_isready" --health-interval=10s --health-timeout=5s --health-retries=3

    steps:
    - uses: actions/checkout@v2

    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.24.2

    - name: Install dependencies
      run: go mod download

    - name: Run tests
      run: go test -v -race -coverprofile=coverage.out ./...

    - name: Upload coverage
      uses: codecov/codecov-action@v2
      with:
        files: ./coverage.out
```

#### 8.1.2 GitLab CI

**.gitlab-ci.yml**:

```yaml
stages:
  - test

test:
  stage: test
  image: golang:1.24.2

  services:
    - mysql:5.6
    - postgres:latest

  variables:
    MYSQL_ROOT_PASSWORD: root
    MYSQL_DATABASE: goadmin-test
    POSTGRES_PASSWORD: root
    POSTGRES_DB: goadmin-test

  before_script:
    - go mod download

  script:
    - go test -v -race -coverprofile=coverage.out ./...

  coverage: '/coverage: \d+\.\d+% of statements/'

  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml
```

### 8.2 测试报告

#### 8.2.1 生成测试报告

```bash
# 生成覆盖率报告
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html

# 生成 JUnit XML 报告
go get github.com/jstemmer/go-junit-report/v2
go test -v ./... 2>&1 | go-junit-report > report.xml
```

#### 8.2.2 上传测试报告

```yaml
- name: Upload test results
  uses: actions/upload-artifact@v2
  with:
    name: test-results
    path: |
      coverage.html
      report.xml
```

---

## 9. 测试最佳实践

### 9.1 测试编写原则

1. **独立性**: 每个测试应该独立运行，不依赖其他测试
2. **可读性**: 测试代码应该清晰易读
3. **可维护性**: 测试代码应该易于维护和更新
4. **快速执行**: 单元测试应该快速执行
5. **全面覆盖**: 测试应该覆盖所有关键功能

### 9.2 测试命名规范

```go
// 好的测试命名
func TestLoginWithValidCredentials(t *testing.T) {}
func TestLoginWithInvalidCredentials(t *testing.T) {}
func TestLoginWithEmptyUsername(t *testing.T) {}

// 不好的测试命名
func TestLogin1(t *testing.T) {}
func TestLogin2(t *testing.T) {}
func TestLogin3(t *testing.T) {}
```

### 9.3 测试组织

```go
// 按功能组织测试
func TestUserService_GetUser(t *testing.T) {}
func TestUserService_CreateUser(t *testing.T) {}
func TestUserService_UpdateUser(t *testing.T) {}
func TestUserService_DeleteUser(t *testing.T) {}

// 按场景组织测试
func TestUserService_GetUser_WithValidID(t *testing.T) {}
func TestUserService_GetUser_WithInvalidID(t *testing.T) {}
func TestUserService_GetUser_WithNonExistentID(t *testing.T) {}
```

### 9.4 测试断言

```go
// 使用明确的断言
assert.Equal(t, expected, actual)
assert.NotNil(t, actual)
assert.NoError(t, err)

// 避免模糊的断言
assert.True(t, actual == expected)
```

---

## 10. 测试工具

### 10.1 测试框架

| 工具 | 用途 | 安装 |
|-----|------|------|
| testing | Go 标准测试框架 | 内置 |
| testify | 断言库和 Mock | `go get github.com/stretchr/testify` |
| goconvey | BDD 风格测试 | `go get github.com/smartystreets/goconvey` |
| gomonkey | Monkey patching | `go get github.com/agiledragon/gomonkey/v2` |
| httpexpect | HTTP 测试 | `go get github.com/gavv/httpexpect` |
| agouti | Web 浏览器测试 | `go get github.com/sclevine/agouti` |

### 10.2 性能测试工具

| 工具 | 用途 | 安装 |
|-----|------|------|
| go test | 基准测试 | 内置 |
| vegeta | HTTP 压力测试 | `go install github.com/tsenart/vegeta@latest` |
| wrk | HTTP 压力测试 | `apt-get install wrk` |
| pprof | 性能分析 | 内置 |

### 10.3 测试覆盖率工具

| 工具 | 用途 | 安装 |
|-----|------|------|
| go tool cover | 覆盖率分析 | 内置 |
| gocov | 覆盖率工具 | `go get github.com/axw/gocov/gocov` |
| codecov | 覆盖率上传 | 在线服务 |

---

## 11. 总结

GoAdmin 测试策略提供了完整的测试体系，包括:

1. **单元测试**: 测试单个函数和方法
2. **集成测试**: 测试模块之间的交互
3. **黑盒测试**: 测试完整的用户流程
4. **Web 测试**: 测试 Web 界面功能
5. **性能测试**: 测试系统性能

通过遵循本文档的测试策略，可以确保:

- **代码质量**: 发现并修复代码缺陷
- **功能正确性**: 确保所有功能按预期工作
- **性能优化**: 识别性能瓶颈并优化
- **系统稳定性**: 确保系统稳定运行
- **快速迭代**: 支持快速迭代和重构

测试是保证代码质量的重要手段，所有开发人员都应该重视测试，确保代码的可靠性和稳定性。
