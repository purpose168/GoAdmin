# GoAdmin 构建部署流程

## 文档信息

- **项目名称**: GoAdmin
- **文档版本**: v1.0
- **创建日期**: 2026-01-05
- **最后更新**: 2026-01-05
- **文档类型**: 构建部署

---

## 1. 构建流程

### 1.1 环境准备

#### 1.1.1 系统要求

**开发环境**:
- 操作系统: Linux / macOS / Windows
- Go 版本: 1.24.2 或更高
- Git: 2.x 或更高
- Make: 3.81 或更高
- Docker (可选): 20.x 或更高
- Docker Compose (可选): 2.x 或更高

**生产环境**:
- 操作系统: Linux (推荐 CentOS 7+ / Ubuntu 18.04+)
- Go 版本: 1.24.2 或更高
- 数据库: MySQL 5.6+ / PostgreSQL 9.6+ / SQLite 3.x / SQL Server 2012+
- Nginx: 1.18+ (推荐)
- Redis: 5.x+ (可选，用于缓存)

#### 1.1.2 安装 Go

**Linux/macOS**:

```bash
# 下载 Go 安装包
wget https://go.dev/dl/go1.24.2.linux-amd64.tar.gz

# 解压到 /usr/local
sudo tar -C /usr/local -xzf go1.24.2.linux-amd64.tar.gz

# 配置环境变量
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
echo 'export GOPATH=$HOME/go' >> ~/.bashrc
source ~/.bashrc

# 验证安装
go version
```

**Windows**:

1. 下载 Go 安装包: https://go.dev/dl/
2. 运行安装程序
3. 配置环境变量:
   - GOROOT: C:\Go
   - GOPATH: C:\Users\YourName\go
   - PATH: 添加 %GOROOT%\bin 和 %GOPATH%\bin

#### 1.1.3 配置 Go 代理

```bash
# 配置 Go 代理（国内用户推荐）
go env -w GOPROXY=https://mirrors.aliyun.com/goproxy,https://goproxy.cn,direct

# 配置 Go 模块下载模式
go env -w GO111MODULE=on
```

### 1.2 获取源码

```bash
# 克隆仓库
git clone https://github.com/purpose168/GoAdmin.git
cd GoAdmin

# 或者使用 SSH
git clone git@github.com:purpose168/GoAdmin.git
cd GoAdmin
```

### 1.3 安装依赖

```bash
# 下载依赖
go mod download

# 整理依赖
go mod tidy

# 验证依赖
go mod verify
```

### 1.4 构建项目

#### 1.4.1 使用 Make 构建

```bash
# 查看所有可用命令
make help

# 构建项目
make build

# 构建输出
# build/goadmin
```

**Makefile 说明**:

| 命令 | 功能描述 |
|-----|---------|
| `make serve` | 启动服务 |
| `make build` | 构建项目 |
| `make test` | 运行测试 |
| `make fmt` | 格式化代码 |
| `make lint` | 代码检查 |
| `make mod-tidy` | 整理依赖 |
| `make mod-vendor` | 生成 vendor |

#### 1.4.2 使用 Go 构建

```bash
# 构建当前平台
go build -o goadmin .

# 构建 Linux 平台
CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o goadmin-linux .

# 构建 Windows 平台
CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build -o goadmin.exe .

# 构建 macOS 平台
CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build -o goadmin-macos .
```

#### 1.4.3 构建优化

```bash
# 减小二进制文件大小
go build -ldflags="-s -w" -o goadmin .

# 去除调试信息
go build -ldflags="-s -w -buildid=" -o goadmin .

# 启用优化
go build -ldflags="-s -w" -trimpath -o goadmin .
```

### 1.5 编译模板

```bash
# 安装 CLI 工具
go install github.com/purpose168/GoAdmin-adm@latest

# 编译表单模板
adm compile tpl --src ./template/types/tmpls/ --dist ./template/types/tmpl.go --package types --var tmpls

# 编译生成器模板
adm compile tpl --src ./plugins/admin/modules/table/tmpl --dist ./plugins/admin/modules/table/tmpl.go --package table --var tmpls
```

### 1.6 运行项目

```bash
# 使用 Make 运行
make serve

# 直接运行
./goadmin

# 指定配置文件
./goadmin -c config.json

# 指定端口
./goadmin -p 8080
```

---

## 2. Docker 部署

### 2.1 构建镜像

#### 2.1.1 使用 Dockerfile

**Dockerfile**: [Dockerfile](file:///home/pps/code/GoAdmin/GoAdmin/Dockerfile)

```dockerfile
FROM golang:latest

COPY . /home/goadmin

ENV GOPATH=$GOPATH:/home/goadmin/ \
    GOPROXY=https://mirrors.aliyun.com/goproxy,https://goproxy.cn,direct

RUN apt-get update --fix-missing && \
    apt-get install -y zip vim postgresql mysql-common default-mysql-server

WORKDIR /home/goadmin
```

**构建镜像**:

```bash
# 构建镜像
docker build -t goadmin:1.0 .

# 查看镜像
docker images | grep goadmin
```

#### 2.1.2 使用多阶段构建

```dockerfile
# 构建阶段
FROM golang:1.24.2 AS builder

WORKDIR /app
COPY . .

RUN go mod download
RUN go build -o goadmin .

# 运行阶段
FROM alpine:latest

RUN apk --no-cache add ca-certificates

WORKDIR /root/

COPY --from=builder /app/goadmin .

EXPOSE 8080

CMD ["./goadmin"]
```

**构建镜像**:

```bash
docker build -t goadmin:1.0-multi .
```

### 2.2 使用 Docker Compose

**docker-compose.yml**: [docker-compose.yml](file:///home/pps/code/GoAdmin/GoAdmin/docker-compose.yml)

```yaml
version: "3.3"

services:
  mysql:
    image: mysql:5.6
    container_name: mysql
    ports:
      - "3306:3306"
    volumes:
      - mysql:/data
    networks:
      - goadmin
    environment:
      - MYSQL_ROOT_PASSWORD=goadmin

  postgres:
    image: postgres:latest
    container_name: postgres
    ports:
      - "5432:5432"
    volumes:
      - postgres:/data
    networks:
      - goadmin
    environment:
      - POSTGRES_PASSWORD=goadmin

  goadmin:
    image: josingcjx/goadmin:1.1
    tty: true
    container_name: goadmin
    volumes:
      - .:/home/goadmin
    networks:
      - goadmin
    command:
      - /bin/bash

  portainer:
    image: portainer/portainer:latest
    container_name: portainer
    restart: always
    ports:
      - "9000:9000"
    networks:
      - goadmin
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer:/data

networks:
  goadmin: {}

volumes:
  portainer: {}
  postgres: {}
  mysql: {}
```

**启动服务**:

```bash
# 启动所有服务
docker-compose up -d

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f goadmin

# 停止服务
docker-compose down

# 停止并删除数据卷
docker-compose down -v
```

### 2.3 Docker 常用命令

```bash
# 运行容器
docker run -d --name goadmin -p 8080:8080 goadmin:1.0

# 查看容器日志
docker logs -f goadmin

# 进入容器
docker exec -it goadmin /bin/bash

# 停止容器
docker stop goadmin

# 启动容器
docker start goadmin

# 删除容器
docker rm goadmin

# 删除镜像
docker rmi goadmin:1.0
```

---

## 3. 生产环境部署

### 3.1 系统配置

#### 3.1.1 创建用户

```bash
# 创建 goadmin 用户
sudo useradd -r -s /bin/false goadmin

# 创建应用目录
sudo mkdir -p /opt/goadmin
sudo chown goadmin:goadmin /opt/goadmin
```

#### 3.1.2 配置防火墙

```bash
# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --reload

# Ubuntu/Debian
sudo ufw allow 8080/tcp
sudo ufw reload
```

### 3.2 部署应用

#### 3.2.1 上传应用

```bash
# 使用 scp 上传
scp goadmin user@server:/opt/goadmin/

# 使用 rsync 同步
rsync -avz --delete ./ user@server:/opt/goadmin/
```

#### 3.2.2 配置文件

**config.json**:

```json
{
  "url_prefix": "/admin",
  "index_url": "/",
  "login_url": "/login",
  "asset_url": "/assets",
  "domain": "example.com",
  "env": "production",
  "language": "cn",
  "theme": "adminlte",
  "title": "GoAdmin",
  "logo": "<img src=\"/assets/logo.png\" />",
  "session_life_time": 7200,
  "databases": {
    "default": {
      "host": "localhost",
      "port": "3306",
      "user": "goadmin",
      "pwd": "password",
      "name": "goadmin",
      "max_idle_conns": 10,
      "max_open_conns": 100,
      "driver": "mysql"
    }
  },
  "logger": {
    "rotate": true,
    "rotation_size": 100,
    "rotation_time": 24,
    "max_backups": 7,
    "max_age": 30,
    "compress": true
  }
}
```

#### 3.2.3 创建 Systemd 服务

**/etc/systemd/system/goadmin.service**:

```ini
[Unit]
Description=GoAdmin Application
After=network.target mysql.service postgresql.service

[Service]
Type=simple
User=goadmin
Group=goadmin
WorkingDirectory=/opt/goadmin
ExecStart=/opt/goadmin/goadmin -c /opt/goadmin/config.json
Restart=always
RestartSec=5
StandardOutput=journal
StandardError=journal
SyslogIdentifier=goadmin

# 安全设置
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/opt/goadmin

[Install]
WantedBy=multi-user.target
```

**启动服务**:

```bash
# 重载 systemd 配置
sudo systemctl daemon-reload

# 启动服务
sudo systemctl start goadmin

# 设置开机自启
sudo systemctl enable goadmin

# 查看服务状态
sudo systemctl status goadmin

# 查看服务日志
sudo journalctl -u goadmin -f

# 重启服务
sudo systemctl restart goadmin

# 停止服务
sudo systemctl stop goadmin
```

### 3.3 配置 Nginx

#### 3.3.1 安装 Nginx

```bash
# CentOS/RHEL
sudo yum install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx

# Ubuntu/Debian
sudo apt-get install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### 3.3.2 配置反向代理

**/etc/nginx/conf.d/goadmin.conf**:

```nginx
upstream goadmin {
    server 127.0.0.1:8080;
}

server {
    listen 80;
    server_name example.com www.example.com;

    # 重定向到 HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name example.com www.example.com;

    # SSL 证书
    ssl_certificate /etc/ssl/certs/example.com.crt;
    ssl_certificate_key /etc/ssl/private/example.com.key;

    # SSL 配置
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    # 日志
    access_log /var/log/nginx/goadmin_access.log;
    error_log /var/log/nginx/goadmin_error.log;

    # 静态资源
    location /assets/ {
        alias /opt/goadmin/public/assets/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # 代理到 GoAdmin
    location / {
        proxy_pass http://goadmin;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # 超时设置
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;

        # 缓冲设置
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
    }

    # 文件上传
    client_max_body_size 100M;
    client_body_timeout 300s;
}
```

**重启 Nginx**:

```bash
# 测试配置
sudo nginx -t

# 重启 Nginx
sudo systemctl restart nginx

# 重载配置
sudo systemctl reload nginx
```

### 3.4 配置 SSL 证书

#### 3.4.1 使用 Let's Encrypt

```bash
# 安装 certbot
sudo apt-get install certbot python3-certbot-nginx -y

# 获取证书
sudo certbot --nginx -d example.com -d www.example.com

# 自动续期
sudo certbot renew --dry-run
```

#### 3.4.2 手动配置证书

```bash
# 创建证书目录
sudo mkdir -p /etc/ssl/certs /etc/ssl/private

# 复制证书文件
sudo cp example.com.crt /etc/ssl/certs/
sudo cp example.com.key /etc/ssl/private/

# 设置权限
sudo chmod 644 /etc/ssl/certs/example.com.crt
sudo chmod 600 /etc/ssl/private/example.com.key
```

---

## 4. 数据库部署

### 4.1 MySQL 部署

#### 4.1.1 安装 MySQL

```bash
# CentOS/RHEL
sudo yum install mysql-server -y
sudo systemctl start mysqld
sudo systemctl enable mysqld

# Ubuntu/Debian
sudo apt-get install mysql-server -y
sudo systemctl start mysql
sudo systemctl enable mysql
```

#### 4.1.2 创建数据库

```sql
-- 创建数据库
CREATE DATABASE goadmin CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 创建用户
CREATE USER 'goadmin'@'localhost' IDENTIFIED BY 'password';

-- 授权
GRANT ALL PRIVILEGES ON goadmin.* TO 'goadmin'@'localhost';
FLUSH PRIVILEGES;
```

#### 4.1.3 导入数据

```bash
# 导入 SQL 文件
mysql -u goadmin -p goadmin < data/admin.sql

# 或者使用 source 命令
mysql -u goadmin -p goadmin
source /path/to/admin.sql;
```

### 4.2 PostgreSQL 部署

#### 4.2.1 安装 PostgreSQL

```bash
# CentOS/RHEL
sudo yum install postgresql-server -y
sudo postgresql-setup initdb
sudo systemctl start postgresql
sudo systemctl enable postgresql

# Ubuntu/Debian
sudo apt-get install postgresql -y
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

#### 4.2.2 创建数据库

```sql
-- 创建用户
CREATE USER goadmin WITH PASSWORD 'password';

-- 创建数据库
CREATE DATABASE goadmin OWNER goadmin ENCODING 'UTF8';

-- 授权
GRANT ALL PRIVILEGES ON DATABASE goadmin TO goadmin;
```

#### 4.2.3 导入数据

```bash
# 导入 SQL 文件
psql -U goadmin -d goadmin -f data/admin_pg.sql
```

### 4.3 数据库优化

#### 4.3.1 MySQL 优化

**/etc/my.cnf**:

```ini
[mysqld]
# 连接设置
max_connections = 500
max_connect_errors = 100

# 缓冲设置
innodb_buffer_pool_size = 1G
innodb_log_file_size = 256M
innodb_flush_log_at_trx_commit = 2

# 查询缓存
query_cache_size = 64M
query_cache_type = 1

# 慢查询日志
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow-query.log
long_query_time = 2
```

#### 4.3.2 PostgreSQL 优化

**/etc/postgresql/12/main/postgresql.conf**:

```ini
# 连接设置
max_connections = 200

# 内存设置
shared_buffers = 256MB
effective_cache_size = 1GB
work_mem = 16MB

# 检查点设置
checkpoint_completion_target = 0.9
wal_buffers = 16MB

# 日志设置
logging_collector = on
log_directory = 'pg_log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_statement = 'all'
```

---

## 5. 监控与日志

### 5.1 应用日志

#### 5.1.1 日志配置

```json
{
  "logger": {
    "rotate": true,
    "rotation_size": 100,
    "rotation_time": 24,
    "max_backups": 7,
    "max_age": 30,
    "compress": true
  }
}
```

#### 5.1.2 日志查看

```bash
# 查看应用日志
sudo journalctl -u goadmin -f

# 查看错误日志
sudo journalctl -u goadmin -p err

# 查看最近 100 行日志
sudo journalctl -u goadmin -n 100

# 查看指定时间的日志
sudo journalctl -u goadmin --since "2024-01-01 00:00:00"
```

### 5.2 系统监控

#### 5.2.1 使用 htop

```bash
# 安装 htop
sudo apt-get install htop -y

# 运行 htop
htop
```

#### 5.2.2 使用 iotop

```bash
# 安装 iotop
sudo apt-get install iotop -y

# 运行 iotop
sudo iotop
```

#### 5.2.3 使用 netstat

```bash
# 查看端口占用
sudo netstat -tlnp | grep 8080

# 查看连接数
sudo netstat -an | grep 8080 | wc -l
```

### 5.3 性能监控

#### 5.3.1 使用 Prometheus

```bash
# 安装 Prometheus
wget https://github.com/prometheus/prometheus/releases/download/v2.45.0/prometheus-2.45.0.linux-amd64.tar.gz
tar xvfz prometheus-2.45.0.linux-amd64.tar.gz
cd prometheus-2.45.0.linux-amd64

# 配置 Prometheus
cat > prometheus.yml <<EOF
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'goadmin'
    static_configs:
      - targets: ['localhost:8080']
EOF

# 启动 Prometheus
./prometheus --config.file=prometheus.yml
```

#### 5.3.2 使用 Grafana

```bash
# 安装 Grafana
sudo apt-get install -y software-properties-common
sudo add-apt-repository "deb https://packages.grafana.com/oss/deb stable main"
sudo apt-get update
sudo apt-get install grafana -y

# 启动 Grafana
sudo systemctl start grafana-server
sudo systemctl enable grafana-server
```

---

## 6. 备份与恢复

### 6.1 数据库备份

#### 6.1.1 MySQL 备份

```bash
# 备份数据库
mysqldump -u goadmin -p goadmin > backup_$(date +%Y%m%d_%H%M%S).sql

# 压缩备份
gzip backup_$(date +%Y%m%d_%H%M%S).sql

# 自动备份脚本
cat > /opt/backup/mysql_backup.sh <<EOF
#!/bin/bash
BACKUP_DIR="/opt/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p \$BACKUP_DIR
mysqldump -u goadmin -p'password' goadmin | gzip > \$BACKUP_DIR/goadmin_\$DATE.sql.gz
find \$BACKUP_DIR -name "*.sql.gz" -mtime +7 -delete
EOF

chmod +x /opt/backup/mysql_backup.sh

# 添加到 crontab
crontab -e
# 每天凌晨 2 点备份
0 2 * * * /opt/backup/mysql_backup.sh
```

#### 6.1.2 PostgreSQL 备份

```bash
# 备份数据库
pg_dump -U goadmin goadmin > backup_$(date +%Y%m%d_%H%M%S).sql

# 压缩备份
gzip backup_$(date +%Y%m%d_%H%M%S).sql

# 自动备份脚本
cat > /opt/backup/postgres_backup.sh <<EOF
#!/bin/bash
BACKUP_DIR="/opt/backup/postgres"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p \$BACKUP_DIR
pg_dump -U goadmin goadmin | gzip > \$BACKUP_DIR/goadmin_\$DATE.sql.gz
find \$BACKUP_DIR -name "*.sql.gz" -mtime +7 -delete
EOF

chmod +x /opt/backup/postgres_backup.sh
```

### 6.2 应用备份

```bash
# 备份应用文件
tar -czf goadmin_$(date +%Y%m%d_%H%M%S).tar.gz /opt/goadmin

# 备份配置文件
cp /opt/goadmin/config.json /opt/backup/config_$(date +%Y%m%d_%H%M%S).json
```

### 6.3 数据恢复

#### 6.3.1 MySQL 恢复

```bash
# 解压备份文件
gunzip backup_20240101_020000.sql.gz

# 恢复数据库
mysql -u goadmin -p goadmin < backup_20240101_020000.sql
```

#### 6.3.2 PostgreSQL 恢复

```bash
# 解压备份文件
gunzip backup_20240101_020000.sql.gz

# 恢复数据库
psql -U goadmin -d goadmin < backup_20240101_020000.sql
```

---

## 7. 故障排查

### 7.1 常见问题

#### 7.1.1 端口被占用

```bash
# 查看端口占用
sudo netstat -tlnp | grep 8080

# 或者使用 lsof
sudo lsof -i :8080

# 终止占用端口的进程
sudo kill -9 <PID>
```

#### 7.1.2 数据库连接失败

```bash
# 检查数据库服务状态
sudo systemctl status mysql
sudo systemctl status postgresql

# 检查数据库连接
mysql -u goadmin -p -h localhost goadmin

# 检查防火墙
sudo firewall-cmd --list-all
```

#### 7.1.3 权限问题

```bash
# 检查文件权限
ls -la /opt/goadmin

# 修改文件权限
sudo chown -R goadmin:goadmin /opt/goadmin
sudo chmod -R 755 /opt/goadmin
```

### 7.2 日志分析

```bash
# 查看错误日志
sudo journalctl -u goadmin -p err

# 查看最近的错误
sudo journalctl -u goadmin -p err --since "1 hour ago"

# 搜索关键词
sudo journalctl -u goadmin | grep "error"
```

---

## 8. 性能优化

### 8.1 应用优化

#### 8.1.1 启用 Gzip 压缩

```nginx
# Nginx 配置
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;
```

#### 8.1.2 配置缓存

```nginx
# 静态资源缓存
location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

### 8.2 数据库优化

#### 8.2.1 创建索引

```sql
-- 创建索引
CREATE INDEX idx_username ON users(username);
CREATE INDEX idx_email ON users(email);
CREATE INDEX idx_created_at ON users(created_at);
```

#### 8.2.2 优化查询

```sql
-- 使用 EXPLAIN 分析查询
EXPLAIN SELECT * FROM users WHERE username = 'admin';

-- 避免使用 SELECT *
SELECT id, username, email FROM users WHERE username = 'admin';

-- 使用 LIMIT 限制结果数量
SELECT * FROM users LIMIT 100;
```

---

## 9. 安全加固

### 9.1 系统安全

#### 9.1.1 更新系统

```bash
# CentOS/RHEL
sudo yum update -y

# Ubuntu/Debian
sudo apt-get update && sudo apt-get upgrade -y
```

#### 9.1.2 配置防火墙

```bash
# CentOS/RHEL
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --permanent --remove-port=3306/tcp
sudo firewall-cmd --reload

# Ubuntu/Debian
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw deny 3306/tcp
sudo ufw enable
```

### 9.2 应用安全

#### 9.2.1 配置 HTTPS

```nginx
# 强制 HTTPS
server {
    listen 80;
    server_name example.com;
    return 301 https://$server_name$request_uri;
}
```

#### 9.2.2 安全头

```nginx
# 添加安全头
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "no-referrer-when-downgrade" always;
add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
```

---

## 10. 持续集成/持续部署

### 10.1 CI/CD 流程

```
代码提交
    ↓
Git Push
    ↓
触发 CI
    ↓
代码检查
    ↓
运行测试
    ↓
构建镜像
    ↓
推送到镜像仓库
    ↓
触发 CD
    ↓
部署到测试环境
    ↓
自动化测试
    ↓
部署到生产环境
```

### 10.2 GitHub Actions 示例

**.github/workflows/deploy.yml**:

```yaml
name: Deploy

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.24.2

    - name: Install dependencies
      run: go mod download

    - name: Run tests
      run: go test ./...

    - name: Build
      run: go build -o goadmin .

    - name: Build Docker image
      run: docker build -t goadmin:${{ github.sha }} .

    - name: Push to Docker Hub
      run: |
        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
        docker push goadmin:${{ github.sha }}

    - name: Deploy to server
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        key: ${{ secrets.SERVER_KEY }}
        script: |
          docker pull goadmin:${{ github.sha }}
          docker stop goadmin
          docker rm goadmin
          docker run -d --name goadmin -p 8080:8080 goadmin:${{ github.sha }}
```

---

## 11. 总结

GoAdmin 构建部署流程涵盖了从开发环境到生产环境的完整部署过程。通过本文档，开发者可以:

1. **快速构建**: 使用 Make 或 Go 命令快速构建项目
2. **容器化部署**: 使用 Docker 和 Docker Compose 简化部署
3. **生产部署**: 配置 Systemd 和 Nginx 实现生产环境部署
4. **监控运维**: 配置监控和日志系统
5. **备份恢复**: 实现数据库和应用的备份恢复
6. **性能优化**: 优化应用和数据库性能
7. **安全加固**: 加强系统和应用安全
8. **CI/CD**: 实现持续集成和持续部署

遵循本文档的指导，可以确保 GoAdmin 应用稳定、高效、安全地运行在生产环境中。
